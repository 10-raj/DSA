#include <iostream>
#include <stack>
#include <string>
#include <iomanip>
using namespace std;

class InfixConverter {
private:
    stack<char> opStack;
    string postfix;

    int precedence(char op) {
        switch(op) {
            case '^': case '$': return 4;
            case '*': case '/': case '%': return 3;
            case '+': case '-': return 2;
            case '(': case '{': case '[': return 1;
        }
        return 0;
    }

    bool isOperator(char c) {
        return (c=='+' || c=='-' || c=='*' || c=='/' || c=='%' || c=='^' || c=='$');
    }

    bool isOperand(char c) {
        return ((c >= 'a' && c <= 'z') ||
                (c >= 'A' && c <= 'Z') ||
                (c >= '0' && c <= '9'));
    }

    string stackToString(stack<char> s) {
        string res = "";
        while(!s.empty()) {
            res = s.top() + res;
            s.pop();
        }
        return res;
    }

public:
    string convertWithTable(string infix) {
        postfix = "";
        while(!opStack.empty()) opStack.pop();

        cout << left << setw(15) << "Scanned"
             << setw(15) << "Postfix"
             << setw(15) << "OpStack" << endl;
        cout << "---------------------------------------------" << endl;

        for (size_t i = 0; i < infix.length(); i++) {
            char c = infix[i];
            if(isOperand(c)) {
                postfix += c;
            }
            else if(c=='(' || c=='{' || c=='[') {
                opStack.push(c);
            }
            else if(c==')' || c=='}' || c==']') {
                while(!opStack.empty() && !(opStack.top()=='(' || opStack.top()=='{' || opStack.top()=='[')) {
                    postfix += opStack.top();
                    opStack.pop();
                }
                if(!opStack.empty()) opStack.pop();
            }
            else if(isOperator(c)) {
                while(!opStack.empty() && precedence(opStack.top()) >= precedence(c)) {
                    postfix += opStack.top();
                    opStack.pop();
                }
                opStack.push(c);
            }

            cout << left << setw(15) << c
                 << setw(15) << postfix
                 << setw(15) << stackToString(opStack) << endl;
        }

        while(!opStack.empty()) {
            postfix += opStack.top();
            opStack.pop();
            cout << left << setw(15) << "pop"
                 << setw(15) << postfix
                 << setw(15) << stackToString(opStack) << endl;
        }

        return postfix;
    }
};

int main() {
    string infix;
    cout << "Enter infix expression: ";
    cin >> infix;

    InfixConverter converter;
    string postfix = converter.convertWithTable(infix);

    cout << "\nFinal Postfix Expression: " << postfix << endl;
    return 0;
}
